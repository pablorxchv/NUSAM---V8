<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUSAM - Núcleo de Saúde Mental</title>
    <meta name="description" content="Sistema de Gestão de Saúde Mental - Alcântaras/CE">
    <meta name="theme-color" content="#1FB8CD">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTlVTQU0gLSBOw7pjbGVvIGRlIFNhw7pkZSBNZW50YWwiLCJzaG9ydF9uYW1lIjoiTlVTQU0iLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwidGhlbWVfY29sb3IiOiIjMUZCOENEIiwiYmFja2dyb3VuZF9jb2xvciI6IiNGQ0ZDRjkiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhRZ1BWMGlNVEk0SWlCMmFXVjNRbTk0UFNJd0lEQWdNVEk0SURFME9DSWdhWFJ6YVRwa2FXMXZAZWT3JWJuWXRRekZXVmc8IS0tQ21sdFlTZFFiblI0TGlCRk1ESGdYekFxWk9saTB0ViIsInNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1USTRJaUJvWldsbmFIUTlJbE5sTlJJaUlIWnBaWGRDYjNnOUlqQWdNQ0F4TWpnZ01UUTBJR0ZzYkdWNElFbCI6IWJHTZoLCJzaXplcyI6IjE5Mngz5OREifV19">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxNDgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiByeD0iMjQiIGZpbGw9IiMxRkI4Q0QiLz4KPHN2ZyB4PSIzMiIgeT0iMzIiIHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgZmlsbD0iI0ZDRkNGOSI+CjxwYXRoIGQ9Im0yMiAxMWMwLTMuODY1IDMuMTM1LTcgNy03czcgMy4xMzUgNyA3LTMuMTM1IDctNyA3LTctMy4xMzUtNy03eiIvPgo8cGF0aCBkPSJtMjMgMTJjMC0yLjIwOSAxLjc5MS00IDQtNHM0IDEuNzkxIDQgNC0xLjc5MSA0LTQgNC00LTEuNzkxLTQtNHoiLz4KPC9zdmc+">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- PWA Install Prompt -->
    <div id="installPrompt" class="install-prompt hidden">
  <div class="install-content">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
      <polyline points="7,10 12,15 17,10"/>
      <line x1="12" y1="15" x2="12" y2="3"/>
    </svg>
    <div>
      <h4>Instalar NUSAM</h4>
      <p>Instale o aplicativo no seu dispositivo para acesso rápido e offline.<br>
      Ao instalar o app, você poderá abrir mesmo sem internet.</p>
    </div>
    <div class="install-actions">
      <button class="btn btn--outline btn--sm" onclick="dismissInstallPrompt()">Agora não</button>
      <button class="btn btn--primary btn--sm" onclick="installPWA()">Instalar</button>
    </div>
  </div>
</div>


    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2>NUSAM</h2>
            <p>Núcleo de Saúde Mental</p>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen hidden">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                    </svg>
                </div>
                <h1>NUSAM</h1>
                <p>Núcleo de Saúde Mental - Alcântaras/CE</p>
            </div>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="username" class="form-label">Usuário</label>
                    <input type="text" id="username" class="form-control" required placeholder="Digite seu usuário">
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Senha</label>
                    <input type="password" id="password" class="form-control" required placeholder="Digite sua senha">
                </div>
                <button type="submit" class="btn btn--primary btn--full-width">Entrar</button>
                <div class="login-footer">
                    <small>Sistema em conformidade com LGPD e CFP</small>
                </div>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="main-app hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-toggle" onclick="toggleSidebar()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="12" x2="21" y2="12"/>
                        <line x1="3" y1="18" x2="21" y2="18"/>
                    </svg>
                </button>
                <div class="breadcrumb">
                    <span id="breadcrumbText">Núcleo de Sáude Mental - Alcântaras/CE</span>
                </div>
            </div>
            <div class="header-right">
                <button class="theme-toggle" onclick="toggleTheme()" title="Alternar tema">
                    <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"/>
                        <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                    </svg>
                    <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                </button>
                <div class="user-menu">
                    <button class="user-button" onclick="toggleUserMenu()">
                        <span id="userName">Usuário</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6,9 12,15 18,9"/>
                        </svg>
                    </button>
                    <div class="user-dropdown hidden">
                        <a href="#" onclick="showProfile()">Perfil</a>
                        <a href="#" onclick="showSettings()">Configurações</a>
                        <hr>
                        <a href="#" onclick="logout()">Sair</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2">
                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                </svg>
                <h3>NUSAM</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="showDashboard()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="showPatients()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                    <span>Pacientes</span>
                </a>
                <a href="#" class="nav-item" onclick="showReports()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10,9 9,9 8,9"/>
                    </svg>
                    <span>Relatórios</span>
                </a>
                <a href="#" class="nav-item" onclick="showDocuments()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/>
                        <polyline points="13,2 13,9 20,9"/>
                    </svg>
                    <span>Documentos</span>
                </a>
                <a href="#" class="nav-item" onclick="showSettings()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    <span>Configurações</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard View -->
            <div id="dashboardView" class="view active">
                <div class="view-header">
                    <h1>Dashboard</h1>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalPatients">0</h3>
                            <p>Total de Pacientes</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M8 2v4m8-4v4M3 10h18M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="activeFollowUps">0</h3>
                            <p>Em Acompanhamento</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="significantImprovement">0</h3>
                            <p>Melhora Significativa</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3 id="documentsCount">0</h3>
                            <p>Documentos</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-content">
                    <div class="dashboard-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h2>Atividades Recente</h2>
                        </div>
                        <div class="card">
                            <div class="card__body">
                                <div class="activity-list" id="activityList">
                                    <!-- Activity items will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-section">
                        <h2>Ações Rápidas</h2>
                        <div class="quick-actions">
                            <button class="btn btn--primary" onclick="showAddPatient()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                Novo Paciente
                            </button>
                            <button class="btn btn--outline" onclick="showReports()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14,2 14,8 20,8"/>
                                </svg>
                                Relatórios
                            </button>
                            <button class="btn btn--outline" onclick="showPatients()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="M21 21l-4.35-4.35"/>
                                </svg>
                                Buscar Paciente
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patients View -->
            <div id="patientsView" class="view">
                <div class="view-header">
                    <h1>Gestão de Pacientes</h1>
                    <button class="btn btn--primary" onclick="showAddPatient()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Novo Paciente
                    </button>
                </div>
                
                <div class="search-filters">
                    <div class="search-bar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <path d="M21 21l-4.35-4.35"/>
                        </svg>
                        <input type="text" id="patientSearch" placeholder="Buscar por nome, telefone..." oninput="filterPatients()">
                    </div>
                    
                    <div class="filters">
                        <select id="statusFilter" class="form-control" onchange="filterPatients()">
                            <option value="">Todos os Status</option>
                            <option value="Em acompanhamento">Em acompanhamento</option>
                            <option value="Melhora significativa">Melhora significativa</option>
                            <option value="Alta terapêutica">Alta terapêutica</option>
                            <option value="Estável">Estável</option>
                            <option value="Em recuperação">Em recuperação</option>
                            <option value="Faltoso">Faltoso</option>
                            <option value="Encaminhado para CAPS">Encaminhado para CAPS</option>
                        </select>
                        
                        <select id="unitFilter" class="form-control" onchange="filterPatients()">
                            <option value="">Todos os Postos</option>
                            <option value="ROSAPOLES">ROSAPOLES</option>
                            <option value="FRANCISCO MACHADO ALCANTARA">FRANCISCO MACHADO ALCANTARA</option>
                            <option value="DOUTOR SHIGUEO NAKAMURA">DOUTOR SHIGUEO NAKAMURA</option>
                            <option value="JOAQUIM XIMENES CARVALHO">JOAQUIM XIMENES CARVALHO</option>
                            <option value="HOSPITAL ANTONIO ROCHA FREIRE">HOSPITAL ANTONIO ROCHA FREIRE</option>
                            <option value="CEA FRANCISCA LINHARES LUSTOSA XIMENES">CEA FRANCISCA LINHARES LUSTOSA XIMENES</option>
                            <option value="SITIO SAQUINHO">SITIO SAQUINHO</option>
                            <option value="RAIMUNDO NONATO DE ALBUQUERQUE">RAIMUNDO NONATO DE ALBUQUERQUE</option>
                            <option value="VEREADOR JOSE REINALDO">VEREADOR JOSE REINALDO</option>
                            <option value="BOMFIM">BOMFIM</option>
                        </select>
                        
                        <input type="text" id="acsFilter" class="form-control" placeholder="Buscar por ACS..." oninput="filterPatients()">
                    </div>
                </div>
                
                <div class="patients-list" id="patientsList">
                    <!-- Patients will be populated by JavaScript -->
                </div>
            </div>

            <!-- Add/Edit Patient View -->
            <div id="patientFormView" class="view">
                <div class="view-header">
                    <h1 id="patientFormTitle">Novo Paciente</h1>
                    <button class="btn btn--outline" onclick="showPatients()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15,18 9,12 15,6"/>
                        </svg>
                        Voltar
                    </button>
                </div>
                
                <form id="patientForm" class="patient-form">
                    <div class="form-section">
                        <h3>Dados Pessoais</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patientNome" class="form-label">Nome Completo *</label>
                                <input type="text" id="patientNome" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="patientIdade" class="form-label">Idade *</label>
                                <input type="number" id="patientIdade" class="form-control" min="0" max="120" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patientSexo" class="form-label">Sexo *</label>
                                <select id="patientSexo" class="form-control" required>
                                    <option value="">Selecione...</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Feminino">Feminino</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="patientTelefone" class="form-label">Telefone *</label>
                                <input type="tel" id="patientTelefone" class="form-control" required placeholder="(85) 99999-9999">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="patientEndereco" class="form-label">Endereço Completo *</label>
                            <input type="text" id="patientEndereco" class="form-control" required>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Informações do SUS</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patientPostoSaude" class="form-label">Posto de Saúde *</label>
                                <select id="patientPostoSaude" class="form-control" required>
                                    <option value="">Selecione...</option>
                                    <option value="ROSAPOLES">ROSAPOLES</option>
                                    <option value="FRANCISCO MACHADO ALCANTARA">FRANCISCO MACHADO ALCANTARA</option>
                                    <option value="DOUTOR SHIGUEO NAKAMURA">DOUTOR SHIGUEO NAKAMURA</option>
                                    <option value="JOAQUIM XIMENES CARVALHO">JOAQUIM XIMENES CARVALHO</option>
                                    <option value="HOSPITAL ANTONIO ROCHA FREIRE">HOSPITAL ANTONIO ROCHA FREIRE</option>
                                    <option value="CEA FRANCISCA LINHARES LUSTOSA XIMENES">CEA FRANCISCA LINHARES LUSTOSA XIMENES</option>
                                    <option value="SITIO SAQUINHO">SITIO SAQUINHO</option>
                                    <option value="RAIMUNDO NONATO DE ALBUQUERQUE">RAIMUNDO NONATO DE ALBUQUERQUE</option>
                                    <option value="VEREADOR JOSE REINALDO">VEREADOR JOSE REINALDO</option>
                                    <option value="BOMFIM">BOMFIM</option>
                                </select>
                            </div>
                           
                        </div>
                        <div class="form-group">
                            <label for="patientAcsResponsavel" class="form-label">ACS Responsável *</label>
                            <input type="text" id="patientAcsResponsavel" class="form-control" required placeholder="Digite o nome do ACS responsável">
                            <small style="color: var(--color-text-secondary); font-size: var(--font-size-xs); margin-top: var(--space-4); display: block;">Digite livremente o nome do Agente Comunitário de Saúde</small>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Informações Clínicas</h3>
                        <div class="form-group">
                            <label for="patientQueixaPrincipal" class="form-label">Queixa Principal *</label>
                            <textarea id="patientQueixaPrincipal" class="form-control" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="patientHistoricoFamiliar" class="form-label">Histórico Familiar</label>
                            <textarea id="patientHistoricoFamiliar" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="patientHistoricoSaudeMental" class="form-label">Histórico de Saúde Mental</label>
                            <textarea id="patientHistoricoSaudeMental" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="patientTratamentosAnteriores" class="form-label">Tratamentos Anteriores</label>
                            <textarea id="patientTratamentosAnteriores" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patientFatoresRisco" class="form-label">Fatores de Risco</label>
                                <textarea id="patientFatoresRisco" class="form-control" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="patientFatoresProtecao" class="form-label">Fatores de Proteção</label>
                                <textarea id="patientFatoresProtecao" class="form-control" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="patientEvolucao" class="form-label">Evolução</label>
                            <textarea id="patientEvolucao" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="patientConduta" class="form-label">Conduta</label>
                            <textarea id="patientConduta" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="patientStatus" class="form-label">Status do Acompanhamento *</label>
                            <select id="patientStatus" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="Em acompanhamento">Em acompanhamento</option>
                                <option value="Melhora significativa">Melhora significativa</option>
                                <option value="Alta terapêutica">Alta terapêutica</option>
                                <option value="Estável">Estável</option>
                                <option value="Em recuperação">Em recuperação</option>
                                <option value="Faltoso">Faltoso</option>
                                <option value="Encaminhado para CAPS">Encaminhado para CAPS</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="patientObservacoes" class="form-label">Observações Gerais</label>
                            <textarea id="patientObservacoes" class="form-control" rows="4" placeholder="Observações adicionais sobre o caso..."></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn--outline" onclick="showPatients()">Cancelar</button>
                        <button type="submit" class="btn btn--primary">Salvar Paciente</button>
                    </div>
                </form>
            </div>

            <!-- Patient Detail View -->
            <div id="patientDetailView" class="view">
                <div class="view-header">
                    <h1 id="patientDetailName">Detalhes do Paciente</h1>
                    <div class="header-actions">
                        <button class="btn btn--outline" onclick="editPatient(appState.currentPatientId)">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                            </svg>
                            Editar
                        </button>
                        <button class="btn btn--primary" onclick="generatePatientReport(appState.currentPatientId)">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                            Gerar Relatório
                        </button>
                        <button class="btn btn--outline" onclick="showPatients()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15,18 9,12 15,6"/>
                            </svg>
                            Voltar
                        </button>
                    </div>
                </div>
                
                <div class="patient-detail-content" id="patientDetailContent">
                    <!-- Patient details will be populated by JavaScript -->
                </div>
            </div>

            <!-- Reports View -->
            <div id="reportsView" class="view">
                <div class="view-header">
                    <h1>Relatórios</h1>
                </div>
                
                <div class="reports-content">
                    <div class="report-cards">
                        <div class="card">
                            <div class="card__body">
                                <h3>Relatório Geral de Pacientes</h3>
                                <p>Relatório completo com todos os pacientes cadastrados</p>
                                <button class="btn btn--primary" onclick="generateGeneralReport()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7,10 12,15 17,10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                    Gerar PDF
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card__body">
                                <h3>Estatísticas por Posto de Saúde</h3>
                                <p>Distribuição de pacientes por posto de saúde</p>
                                <button class="btn btn--primary" onclick="generateUBSReport()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7,10 12,15 17,10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                    Gerar PDF
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card__body">
                                <h3>Relatório por Status</h3>
                                <p>Pacientes organizados por status de acompanhamento</p>
                                <button class="btn btn--primary" onclick="generateStatusReport()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7,10 12,15 17,10"/>
                                        <line x1="12" y1="15" x2="12" y2="3"/>
                                    </svg>
                                    Gerar PDF
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="statistics-section">
                        <h2>Estatísticas Gerais</h2>
                        <div class="stats-chart">
                            <canvas id="statusChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>

<!-- Documents View -->
<div id="documentsView" class="view">
    <div class="view-header">
        <h1>Gerenciamento de Documentos</h1>
        <button class="btn btn--primary" onclick="showUploadDocument()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="17,8 12,3 7,8"/>
                <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
            Enviar Documento
        </button>
    </div>
    
    <div class="documents-content">
        <div class="documents-filters">
            <div class="search-bar">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="M21 21l-4.35-4.35"/>
                </svg>
                <input type="text" id="documentSearch" placeholder="Buscar documentos..." oninput="filterDocuments()">
            </div>
            
            <select id="documentPatientFilter" class="form-control" onchange="filterDocuments()">
                <option value="">Todos os pacientes</option>
            </select>
        </div>
        
        <div class="documents-list" id="documentsList">
            <!-- Documents will be populated by JavaScript -->
        </div>
    </div>
</div>

            <!-- Settings View -->
            <div id="settingsView" class="view">
                <div class="view-header">
                    <h1>Configurações</h1>
                </div>
                
                <div class="settings-content">
                    <div class="settings-section">
                        <div class="settings-header">
                            <h2>Informações da Unidade</h2>
                            <button class="btn btn--primary" onclick="openSettingsEdit()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                                    <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                                </svg>
                                Editar Informações
                            </button>
                        </div>
                        <div class="card">
                            <div class="card__body">
                                <div class="info-item">
                                    <strong>Nome da Unidade:</strong>
                                    <span id="displayNomeUnidade">Núcleo de Saúde Mental - Alcântaras/CE</span>
                                </div>
                                <div class="info-item">
                                    <strong>Responsável Técnico:</strong>
                                    <span id="displayResponsavelTecnico">Dra. Claudia Mendes</span>
                                </div>
                                <div class="info-item">
                                    <strong>CRP:</strong>
                                    <span id="displayCrpResponsavel">11/12345</span>
                                </div>
                                <div class="info-item">
                                    <strong>Telefone:</strong>
                                    <span id="displayTelefoneContato">(85) 3366-1234</span>
                                </div>
                                <div class="info-item">
                                    <strong>Endereço:</strong>
                                    <span id="displayEnderecoUnidade">Rua da Saúde, 100 - Centro, Alcântaras/CE</span>
                                </div>
                                <div class="info-item">
                                    <strong>Email:</strong>
                                    <span id="displayEmailContato">saudemental@alcantaras.ce.gov.br</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h2>Preferências do Sistema</h2>
                        <div class="card">
                            <div class="card__body">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <strong>Modo Escuro</strong>
                                        <p>Alternar entre tema claro e escuro</p>
                                    </div>
                                    <button class="btn btn--outline" onclick="toggleTheme()" id="themeToggleBtn">
                                        Alternar Tema
                                    </button>
                                </div>
                                
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <strong>Backup Automático</strong>
                                        <p>Backup automático dos dados (simulado)</p>
                                    </div>
                                    <div class="status status--success">Ativo</div>
                                </div>
                                
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <strong>Conformidade LGPD</strong>
                                        <p>Sistema em conformidade com LGPD e CFP</p>
                                    </div>
                                    <div class="status status--success">Conforme</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h2>Sobre o Sistema</h2>
                        <div class="card">
                            <div class="card__body">
                                <div class="info-item">
                                    <strong>Versão:</strong>
                                    <span>1.0.0</span>
                                </div>
                                <div class="info-item">
                                    <strong>Última Atualização:</strong>
                                    <span>Outubro 2024</span>
                                </div>
                                <div class="info-item">
                                    <strong>Tecnologia:</strong>
                                    <span>Progressive Web App (PWA)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Document Viewer Modal -->
<div id="documentViewerModal" class="modal hidden">
    <div class="modal-content" style="max-width: 90%; max-height: 90%;">
        <div class="modal-header">
            <h3 id="viewerDocTitle">Visualizar Documento</h3>
            <button class="modal-close" onclick="closeDocumentViewer()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
        <div class="modal-body" style="padding: 0; height: 70vh;">
            <div id="documentViewerContent" style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: var(--color-background);">
                <!-- Carregamento JS -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn--primary" onclick="closeDocumentViewer()">Fechar</button>
        </div>
    </div>
</div>

<!-- Modal de Upload de Documento -->
<div id="documentModal" class="modal hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Upload de Documento</h3>
            <button class="modal-close" onclick="closeDocumentModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <form id="documentForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="docPatient" class="form-label">Paciente</label>
                    <select id="docPatient" class="form-control" required>
                        <option value="">Selecione o paciente...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="docTitle" class="form-label">Título do Documento</label>
                    <input type="text" id="docTitle" class="form-control" required placeholder="Ex: Laudo médico, Exame laboratorial">
                </div>
                <div class="form-group">
                    <label for="docFile" class="form-label">Arquivo</label>
                    <input type="file" id="docFile" class="form-control" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" required>
                    <small>Formatos aceitos: PDF, DOC, DOCX, JPG, PNG (máx. 10MB)</small>
                </div>
                <div class="form-group">
                    <label for="docDescription" class="form-label">Descrição</label>
                    <textarea id="docDescription" class="form-control" rows="3" placeholder="Descrição adicional do documento..."></textarea>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn--outline" onclick="closeDocumentModal()">Cancelar</button>
            <button type="button" class="btn btn--primary" onclick="uploadDocument()">Enviar Documento</button>
        </div>
    </div>
</div>

    <!-- Settings Edit Modal -->
    <div id="settingsEditModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Configurações da Unidade</h3>
                <button class="modal-close" onclick="closeSettingsEdit()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="settingsEditForm">
                    <div class="form-group">
                        <label for="editNomeUnidade" class="form-label">Nome da Unidade</label>
                        <input type="text" id="editNomeUnidade" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="editResponsavelTecnico" class="form-label">Responsável Técnico</label>
                        <input type="text" id="editResponsavelTecnico" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="editCrpResponsavel" class="form-label">CRP do Responsável</label>
                        <input type="text" id="editCrpResponsavel" class="form-control" placeholder="Ex: 11/12345">
                    </div>
                    <div class="form-group">
                        <label for="editTelefoneContato" class="form-label">Telefone de Contato</label>
                        <input type="tel" id="editTelefoneContato" class="form-control" placeholder="(85) 3366-1234">
                    </div>
                    <div class="form-group">
                        <label for="editEnderecoUnidade" class="form-label">Endereço da Unidade</label>
                        <textarea id="editEnderecoUnidade" class="form-control" rows="2" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="editEmailContato" class="form-label">Email de Contato</label>
                        <input type="email" id="editEmailContato" class="form-control" placeholder="contato@unidade.gov.br">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn--outline" onclick="closeSettingsEdit()">Cancelar</button>
                <button type="button" class="btn btn--primary" onclick="saveSettingsEdit()">Salvar Alterações</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app.js"></script>
<script>
// IDs e funções necessárias:
window.documents = window.documents || [];
window.patients = window.patients || [];
window.dataPersistence = window.dataPersistence || {
    salvarDocumentos: function(list) { /* persistir em localStorage... */ }
};

function showUploadDocument() {
    const select = document.getElementById('docPatient');
    select.innerHTML = '<option value="">Selecione o paciente...</option>';
    window.patients.forEach(p => {
        const option = document.createElement('option');
        option.value = p.id;
        option.textContent = p.nome;
        select.appendChild(option);
    });
    document.getElementById('documentModal').classList.remove('hidden');
}

function closeDocumentModal() {
    document.getElementById('documentModal').classList.add('hidden');
    document.getElementById('documentForm').reset();
}

// A função uploadDocument() deve ser implementada chamando o handle upload do seu backend ou JS de frontend.
// Outras funções JS precisam garantir que acessam as IDs: documentList, docPatient, documentSearch, documentPatientFilter, docTitle, docDescription, docFile, etc.

function closeDocumentViewer() {
    document.getElementById('documentViewerModal').classList.add('hidden');
}

function downloadCurrentDocument() {
    // Implemente o download do documento atualmente visualizado (ex: mantendo ID/índice em variável global de referência)
}

// Atualize outras funções conforme seus handlers originais para garantir integração dos nomes.

</script>
</body>
</html>
